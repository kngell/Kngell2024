# Emergency zsh configuration to fix hanging prompt
# This configuration disables problematic features and uses a simple, reliable setup

# Fix locale issues
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8

# Path to your Oh My Zsh installation
export ZSH="$HOME/.oh-my-zsh"

# Use a simple, reliable theme instead of powerlevel10k
ZSH_THEME="robbyrussell"

# Disable auto-update to prevent hanging
zstyle ':omz:update' mode disabled

# Disable marking untracked files under VCS as dirty for faster repo operations
DISABLE_UNTRACKED_FILES_DIRTY="true"

# Use minimal plugins to avoid conflicts
plugins=(git)

# Source Oh My Zsh only if it exists
if [ -f "$ZSH/oh-my-zsh.sh" ]; then
    source $ZSH/oh-my-zsh.sh
fi

# User configuration
export EDITOR='vim'

# Basic aliases
alias ll='ls -la'
alias la='ls -A'
alias l='ls -CF'

# Simple prompt fallback if Oh My Zsh fails
if [ -z "$ZSH_THEME" ] || [ "$ZSH_THEME" = "" ]; then
    PROMPT='%n@%m:%~$ '
fi

# NVM configuration (lazy-loaded for performance)
export NVM_DIR="$HOME/.nvm"

# Function to lazy-load NVM
load_nvm() {
  if [ -s "$NVM_DIR/nvm.sh" ]; then
    source "$NVM_DIR/nvm.sh"
  fi
  if [ -s "$NVM_DIR/bash_completion" ]; then
    source "$NVM_DIR/bash_completion"
  fi
}

# Create aliases that will load NVM when first used
nvm() {
  unset -f nvm node npm npx
  load_nvm
  nvm "$@"
}

node() {
  unset -f nvm node npm npx
  load_nvm
  node "$@"
}

npm() {
  unset -f nvm node npm npx
  load_nvm
  npm "$@"
}

npx() {
  unset -f nvm node npm npx
  load_nvm
  npx "$@"
}

# Disable powerlevel10k instant prompt to prevent hanging
# DO NOT source any p10k files

# Add safety checks for common commands that might hang
timeout_command() {
    timeout 5 "$@" 2>/dev/null || echo "Command timed out: $*"
}

# Override potentially problematic commands with timeout versions
alias curl='timeout 10 curl'
alias wget='timeout 10 wget'

echo "Emergency zsh configuration loaded successfully!"